<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Video Call Test - Both Cameras Working</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        margin: 0;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }
      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 30px;
        font-size: 2.5em;
      }
      .test-section {
        margin: 30px 0;
        padding: 20px;
        border: 2px solid #e1e5e9;
        border-radius: 10px;
        background: #f8f9fa;
      }
      .button {
        display: inline-block;
        padding: 15px 30px;
        margin: 10px;
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        text-decoration: none;
        border-radius: 25px;
        font-weight: bold;
        transition: transform 0.2s;
        border: none;
        cursor: pointer;
        font-size: 16px;
      }
      .button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }
      .patient-button {
        background: linear-gradient(45deg, #56ab2f, #a8e6cf);
      }
      .doctor-button {
        background: linear-gradient(45deg, #667eea, #764ba2);
      }
      .urls {
        background: #2d3748;
        color: #e2e8f0;
        padding: 15px;
        border-radius: 8px;
        font-family: monospace;
        overflow-x: auto;
        margin: 10px 0;
      }
      .status {
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
      }
      .status.success {
        background: #d4edda;
        color: #155724;
      }
      .status.info {
        background: #d1ecf1;
        color: #0c5460;
      }
      .status.warning {
        background: #fff3cd;
        color: #856404;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üé• Video Call Test - Both Cameras Working</h1>

      <div class="status info">
        <strong>üìã Test Instructions:</strong><br />
        1. Click "Generate Test URLs" to create proper video call links<br />
        2. Open Patient Video Call in one browser tab/window<br />
        3. Open Doctor Video Call in another browser tab/window<br />
        4. Both cameras should show immediately like Messenger/WhatsApp!
      </div>

      <div class="test-section">
        <h2>üîß Generate Test URLs</h2>
        <button class="button" onclick="generateTestUrls()">
          Generate Test URLs
        </button>
        <div id="urls-container"></div>
      </div>

      <div class="test-section">
        <h2>üéØ Quick Test Buttons</h2>
        <div id="test-buttons"></div>
      </div>

      <div class="test-section">
        <h2>üìä Expected Behavior</h2>
        <div class="status success">
          <strong>‚úÖ What You Should See:</strong><br />
          ‚Ä¢ <strong>Patient Side:</strong> Their own camera (top-right, green
          border) + Doctor's camera (background when connected)<br />
          ‚Ä¢ <strong>Doctor Side:</strong> Their own camera (top-right, blue
          border) + Patient's camera (background when connected)<br />
          ‚Ä¢ <strong>Connection Status:</strong> Progressive updates (Calling ‚Üí
          Connecting ‚Üí Connected)<br />
          ‚Ä¢ <strong>Working Controls:</strong> Mute, video on/off, hang up
          buttons work properly
        </div>
      </div>

      <div class="test-section">
        <h2>üîç Debugging Info</h2>
        <div id="debug-info"></div>
      </div>
    </div>

    <script>
      function generateTestUrls() {
        // Generate unique test parameters
        const timestamp = Date.now();
        const channelName = `test_channel_${timestamp}`;
        const appId = "0ad1df7f5f9241e7bdccc8324d516f27"; // Test App ID
        const patientUid = Math.floor(Math.random() * 1000000);
        const doctorUid = Math.floor(Math.random() * 1000000);

        // Generate mock tokens (would be real tokens from backend in production)
        const patientToken = `007eJxTYJjbdORgdalInKcUx3Kx4oSKHROC1opbnFzL0b7syoLtRdYKDAaJKYYpaeZppmmWRiaGqeZJKcnJyRbGRiYppoZmaUbmV2c_zQh9-ywjKGotAyMDIwMLAyMDCDCBSWYwyQImVRkSCwryM_NKclPzSuKTc9MzDNOScksMDAwqMwsLkgoMqwoNU3NKWBnMjC1MDQFx5C4b`;
        const doctorToken = `007eJxTYMhYvDbjvdRrV31-xycuX2RLEpRy2l4rH_9v-WX19FlP1H4oMBgkphimpJmnmaZZGpkYpponpSQnJ1sYG5mkmBqapRmZ3539NCP27bOMuHWLWRgZGBlYGBgZQIAJTDKDSRYwqcqQWFCQn5lXkpuaVxKfnJueYZiWlFtiYGBQmVlYkFRgWFVomJpTwsZgbGBiaWAIAPJ5MPY=`;

        const baseUrl = window.location.origin;

        const patientUrl = `${baseUrl}/patient/video-call?channel=${encodeURIComponent(
          channelName
        )}&token=${encodeURIComponent(
          patientToken
        )}&uid=${patientUid}&appId=${appId}&callId=test_call_${timestamp}&appointmentId=test_appointment_${timestamp}`;

        const doctorUrl = `${baseUrl}/doctor/video-call?channel=${encodeURIComponent(
          channelName
        )}&token=${encodeURIComponent(
          doctorToken
        )}&uid=${doctorUid}&appId=${appId}&callId=test_call_${timestamp}&appointmentId=test_appointment_${timestamp}`;

        // Display URLs
        document.getElementById("urls-container").innerHTML = `
                <h3>üìã Generated Test URLs:</h3>
                <p><strong>Patient URL:</strong></p>
                <div class="urls">${patientUrl}</div>
                <p><strong>Doctor URL:</strong></p>
                <div class="urls">${doctorUrl}</div>
            `;

        // Display test buttons
        document.getElementById("test-buttons").innerHTML = `
                <a href="${patientUrl}" target="_blank" class="button patient-button">
                    ü§í Open Patient Video Call
                </a>
                <a href="${doctorUrl}" target="_blank" class="button doctor-button">
                    üë®‚Äç‚öïÔ∏è Open Doctor Video Call
                </a>
                <button class="button" onclick="openBothWindows('${patientUrl}', '${doctorUrl}')">
                    üîÄ Open Both Windows
                </button>
            `;

        // Display debug info
        document.getElementById("debug-info").innerHTML = `
                <div class="status info">
                    <strong>üîç Debug Parameters:</strong><br>
                    ‚Ä¢ Channel: ${channelName}<br>
                    ‚Ä¢ App ID: ${appId}<br>
                    ‚Ä¢ Patient UID: ${patientUid}<br>
                    ‚Ä¢ Doctor UID: ${doctorUid}<br>
                    ‚Ä¢ Timestamp: ${timestamp}
                </div>
            `;
      }

      function openBothWindows(patientUrl, doctorUrl) {
        // Open patient window
        const patientWindow = window.open(
          patientUrl,
          "patient_call",
          "width=800,height=600,left=100,top=100"
        );

        // Open doctor window (offset to the right)
        setTimeout(() => {
          const doctorWindow = window.open(
            doctorUrl,
            "doctor_call",
            "width=800,height=600,left=950,top=100"
          );
        }, 500);

        if (!patientWindow || !doctorWindow) {
          alert(
            "‚ö†Ô∏è Popup blocked! Please allow popups for this site to test both windows."
          );
        }
      }

      // Auto-generate on page load
      window.onload = function () {
        generateTestUrls();
      };
    </script>
  </body>
</html>
